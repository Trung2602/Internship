# Worklog - NgÃ y 29/11/2025

## ğŸ“… ThÃ´ng tin cÆ¡ báº£n
- **NgÃ y**: 29/11/2025
- **Thá»©**: Thá»© Báº£y
- **Tuáº§n thá»±c táº­p**: 5/8
- **Thá»i gian lÃ m viá»‡c**: 18:00 - 22:00 (4 tiáº¿ng)
- **Mood**: ğŸ˜Š Ráº¥t táº­p trung vÃ o viá»‡c thiáº¿t láº­p cÃ¡c tÃ­nh nÄƒng báº£o máº­t vÃ  quáº£n lÃ½ ngÆ°á»i dÃ¹ng.

## ğŸ¯ Má»¥c tiÃªu ngÃ y hÃ´m nay
- [x] Thiáº¿t káº¿ vÃ  triá»ƒn khai API cho quáº£n lÃ½ Page Member vÃ  Page Follower.
- [x] Thiáº¿t láº­p Spring Security cÆ¡ báº£n Ä‘á»ƒ báº¯t Ä‘áº§u triá»ƒn khai Authentication/Authorization.
- [x] Triá»ƒn khai logic cÆ¡ cháº¿ phÃ¢n quyá»n quáº£n trá»‹ Ä‘á»ƒ Ä‘áº£m báº£o chá»‰ Member má»›i cÃ³ quyá»n Ä‘Äƒng táº£i sá»± kiá»‡n.

## ğŸ’¼ CÃ´ng viá»‡c Ä‘Ã£ thá»±c hiá»‡n

### 1. Triá»ƒn khai API cho Page Member vÃ  Page Follower â±ï¸ 1.5 tiáº¿ng
- **MÃ´ táº£**:
    - **Entities**: Táº¡o cÃ¡c Entity má»›i `PageMember.java` vÃ  `PageFollower.java`, Ã¡nh xáº¡ má»‘i quan há»‡ vá»›i `Page.java` vÃ  `User.java` (User.java sáº½ lÃ  Entity tá»« User Service, hiá»‡n táº¡i dÃ¹ng placeholder hoáº·c má»™t ID).
    - **Repositories & Services**: Táº¡o `PageMemberRepository`, `PageFollowerRepository` vÃ  cÃ¡c lá»›p Service tÆ°Æ¡ng á»©ng (`PageMemberService`, `PageFollowerService`) Ä‘á»ƒ xá»­ lÃ½ logic thÃªm/xÃ³a thÃ nh viÃªn vÃ  theo dÃµi/há»§y theo dÃµi.
    - **Controllers**: Táº¡o `PageMemberController` vÃ  `PageFollowerController` vá»›i cÃ¡c API endpoint RESTful (vÃ­ dá»¥: `POST /api/v1/pages/{pageId}/members`, `DELETE /api/v1/pages/{pageId}/members/{userId}`, `POST /api/v1/pages/{pageId}/followers`).
- **Káº¿t quáº£**: CÃ¡c API Ä‘á»ƒ quáº£n lÃ½ thÃ nh viÃªn vÃ  ngÆ°á»i theo dÃµi cá»§a má»™t Page Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai.
- **Tools/Tech**: Spring Boot, Spring Data JPA, IntelliJ IDEA.
- **Links**: [Link GitHub Page Service Repo (commit: Implement Page Member & Follower APIs - placeholder)]

### 2. Thiáº¿t láº­p Spring Security CÆ¡ báº£n â±ï¸ 1.5 tiáº¿ng
- **MÃ´ táº£**:
    - ThÃªm dependency `spring-boot-starter-security` vÃ o `pom.xml`.
    - Táº¡o má»™t `SecurityConfig.java` class extend `WebSecurityConfigurerAdapter` (hoáº·c sá»­ dá»¥ng `SecurityFilterChain` cho Spring Security 5.7+).
    - Cáº¥u hÃ¬nh HTTP security Ä‘á»ƒ:
        - Cho phÃ©p truy cáº­p cÃ´ng khai Ä‘áº¿n cÃ¡c endpoint Ä‘á»c (vÃ­ dá»¥: `GET /api/v1/pages/**`).
        - YÃªu cáº§u xÃ¡c thá»±c cho cÃ¡c endpoint ghi/sá»­a/xÃ³a (vÃ­ dá»¥: `POST /api/v1/pages/**`, `PUT /api/v1/pages/**`).
        - Táº¯t CSRF cho REST API.
    - Äá»ƒ Ä‘Æ¡n giáº£n cho Authentication ban Ä‘áº§u, cÃ³ thá»ƒ cáº¥u hÃ¬nh `inMemoryAuthentication` hoáº·c tÃ­ch há»£p vá»›i má»™t Identity Provider cÆ¡ báº£n. (Táº¡m thá»i chá»‰ cáº¥u hÃ¬nh phÃ¢n quyá»n cÆ¡ báº£n, chÆ°a Ä‘áº§y Ä‘á»§ Authentication).
- **Káº¿t quáº£**: Spring Security Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p vÃ  cáº¥u hÃ¬nh cÆ¡ báº£n Ä‘á»ƒ báº£o vá»‡ cÃ¡c endpoint API cá»§a Page Service.
- **Tools/Tech**: Spring Security, IntelliJ IDEA.
- **Links**: [Link GitHub Page Service Repo (commit: Setup Basic Spring Security - placeholder)]

### 3. Triá»ƒn khai CÆ¡ cháº¿ PhÃ¢n quyá»n Quáº£n trá»‹ (Chá»‰ Member má»›i Ä‘Æ°á»£c Ä‘Äƒng) â±ï¸ 1 tiáº¿ng
- **MÃ´ táº£**:
    - Sá»­ dá»¥ng cÃ¡c annotations `@PreAuthorize` hoáº·c phÆ°Æ¡ng thá»©c programmatic checks trong Service layer.
    - Cáº¥u hÃ¬nh má»™t `PermissionEvaluator` hoáº·c custom `Voter` Ä‘á»ƒ kiá»ƒm tra liá»‡u ngÆ°á»i dÃ¹ng hiá»‡n táº¡i cÃ³ pháº£i lÃ  thÃ nh viÃªn (`PageMember`) cá»§a má»™t Page cá»¥ thá»ƒ hay khÃ´ng.
    - Ãp dá»¥ng kiá»ƒm tra nÃ y vÃ o cÃ¡c phÆ°Æ¡ng thá»©c `createPage`, `updatePage`, `deletePage` trong `PageService` Ä‘á»ƒ Ä‘áº£m báº£o chá»‰ thÃ nh viÃªn Ä‘Æ°á»£c á»§y quyá»n má»›i cÃ³ thá»ƒ thá»±c hiá»‡n.
- **Káº¿t quáº£**: CÆ¡ cháº¿ phÃ¢n quyá»n Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai, Ä‘áº£m báº£o tÃ­nh báº£o máº­t vÃ  Ä‘Ãºng Ä‘áº¯n cá»§a logic nghiá»‡p vá»¥ theo yÃªu cáº§u.
- **Tools/Tech**: Spring Security, Spring Expressions (SpEL), IntelliJ IDEA.
- **Links**: [Link GitHub Page Service Repo (commit: Implement Admin Authorization - placeholder)]

## ğŸ“š Kiáº¿n thá»©c há»c Ä‘Æ°á»£c

### ğŸ”§ Ká»¹ nÄƒng ká»¹ thuáº­t
- **Spring Security Fundamentals**: Náº¯m vá»¯ng cÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n cá»§a Spring Security (Authentication, Authorization, Filters) vÃ  cÃ¡ch cáº¥u hÃ¬nh nÃ³ cho REST API.
- **Role-Based Authorization**: Triá»ƒn khai cÆ¡ cháº¿ phÃ¢n quyá»n dá»±a trÃªn vai trÃ² (vÃ­ dá»¥: Page Member) báº±ng cÃ¡ch sá»­ dá»¥ng `@PreAuthorize` hoáº·c custom permission logic.
- **Relationship Mapping (JPA)**: Thá»±c hÃ nh Ã¡nh xáº¡ cÃ¡c má»‘i quan há»‡ `ManyToOne` hoáº·c `OneToMany` giá»¯a cÃ¡c Entity má»›i (`PageMember`, `PageFollower`, `Page`).

### ğŸ’¡ KhÃ¡i niá»‡m vÃ  lÃ½ thuyáº¿t
- **Authentication vs. Authorization**: Hiá»ƒu rÃµ sá»± khÃ¡c biá»‡t giá»¯a xÃ¡c thá»±c (ai lÃ  báº¡n) vÃ  phÃ¢n quyá»n (báº¡n cÃ³ thá»ƒ lÃ m gÃ¬).
- **Least Privilege Principle**: Ãp dá»¥ng nguyÃªn táº¯c chá»‰ cáº¥p quyá»n tá»‘i thiá»ƒu cáº§n thiáº¿t cho ngÆ°á»i dÃ¹ng Ä‘á»ƒ thá»±c hiá»‡n nhiá»‡m vá»¥.

## ğŸš§ KhÃ³ khÄƒn vÃ  giáº£i phÃ¡p

### Váº¥n Ä‘á» 1: TÃ­ch há»£p Authorization vá»›i User ID tá»« External Service
- **MÃ´ táº£**: Page Service cáº§n kiá»ƒm tra quyá»n cá»§a ngÆ°á»i dÃ¹ng, nhÆ°ng thÃ´ng tin vá» ngÆ°á»i dÃ¹ng (user ID) sáº½ Ä‘áº¿n tá»« má»™t User Service riÃªng biá»‡t (hoáº·c thÃ´ng qua má»™t JWT token). LÃ m tháº¿ nÃ o Ä‘á»ƒ Page Service cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c User ID hiá»‡n táº¡i vÃ  kiá»ƒm tra vai trÃ²/quyá»n cá»§a há»?
- **áº¢nh hÆ°á»Ÿng**: KhÃ´ng thá»ƒ kiá»ƒm tra quyá»n Ä‘Ãºng cÃ¡ch, áº£nh hÆ°á»Ÿng Ä‘áº¿n báº£o máº­t vÃ  logic nghiá»‡p vá»¥.
- **NguyÃªn nhÃ¢n gá»‘c rá»…**: Thiáº¿u User Service vÃ  cÆ¡ cháº¿ Authentication hoÃ n chá»‰nh.
- **CÃ¡ch giáº£i quyáº¿t Ä‘Ã£ Ã¡p dá»¥ng**: Táº¡m thá»i, tÃ´i sáº½ giáº£ Ä‘á»‹nh ráº±ng User ID Ä‘Æ°á»£c truyá»n qua má»™t Header (vÃ­ dá»¥: `X-User-ID`) hoáº·c Ä‘Æ°á»£c trÃ­ch xuáº¥t tá»« má»™t JWT token (chÆ°a xÃ¡c thá»±c). Spring Security sáº½ cÃ³ má»™t filter Ä‘á»ƒ láº¥y User ID nÃ y vÃ  Ä‘Æ°a vÃ o `SecurityContextHolder`. Sau Ä‘Ã³, `PermissionEvaluator` sáº½ sá»­ dá»¥ng User ID nÃ y Ä‘á»ƒ kiá»ƒm tra xem nÃ³ cÃ³ tá»“n táº¡i trong báº£ng `PageMember` cá»§a Page tÆ°Æ¡ng á»©ng hay khÃ´ng.
- **Káº¿t quáº£ sau khi giáº£i quyáº¿t**: CÃ³ má»™t luá»“ng lÃ m viá»‡c táº¡m thá»i cho authorization, cÃ³ thá»ƒ dá»… dÃ ng má»Ÿ rá»™ng khi User Service vÃ  Authentication JWT Ä‘Æ°á»£c triá»ƒn khai.
- **BÃ i há»c rÃºt ra**: Khi lÃ m viá»‡c vá»›i Microservices, cáº§n cÃ³ má»™t chiáº¿n lÆ°á»£c rÃµ rÃ ng Ä‘á»ƒ truyá»n thÃ´ng tin xÃ¡c thá»±c/á»§y quyá»n giá»¯a cÃ¡c service. JWT lÃ  má»™t lá»±a chá»n phá»• biáº¿n.

## ğŸ’­ Suy ngáº«m & Nháº­n thá»©c

### HÃ´m nay cÃ³ gÃ¬ diá»…n ra tá»‘t Ä‘áº¹p?
- CÃ¡c API cho Page Member vÃ  Page Follower Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai.
- Spring Security Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p cÆ¡ báº£n vÃ  cÆ¡ cháº¿ phÃ¢n quyá»n cho admin Ä‘Ã£ hoáº¡t Ä‘á»™ng.
- Cáº£m tháº¥y ráº¥t hÃ i lÃ²ng khi cÃ¡c tÃ­nh nÄƒng quan trá»ng vá» báº£o máº­t vÃ  quáº£n lÃ½ ngÆ°á»i dÃ¹ng Ä‘Ã£ báº¯t Ä‘áº§u cÃ³ hÃ¬nh hÃ i.

### Cáº§n cáº£i thiá»‡n Ä‘iá»u gÃ¬?
- Cáº§n triá»ƒn khai Ä‘áº§y Ä‘á»§ Authentication (vÃ­ dá»¥: tÃ­ch há»£p JWT) Ä‘á»ƒ cÃ³ má»™t há»‡ thá»‘ng báº£o máº­t hoÃ n chá»‰nh.
- Viáº¿t Unit/Integration Tests cho cÃ¡c API vÃ  logic phÃ¢n quyá»n Ä‘Ã£ táº¡o.

### ThÃ´ng tin chi tiáº¿t chÃ­nh
- Spring Security lÃ  má»™t framework máº¡nh máº½ nhÆ°ng cÅ©ng Ä‘Ã²i há»i sá»± hiá»ƒu biáº¿t sÃ¢u sáº¯c Ä‘á»ƒ cáº¥u hÃ¬nh Ä‘Ãºng vÃ  an toÃ n.
- PhÃ¢n quyá»n theo Resource (vÃ­ dá»¥: ngÆ°á»i dÃ¹ng cÃ³ quyá»n trÃªn má»™t Page cá»¥ thá»ƒ) lÃ  má»™t yÃªu cáº§u phá»• biáº¿n vÃ  cáº§n Ä‘Æ°á»£c thiáº¿t káº¿ cáº©n tháº­n.

### CÃ¢u há»i & Tháº¯c máº¯c
- LÃ m tháº¿ nÃ o Ä‘á»ƒ cáº¥u hÃ¬nh Spring Security cho JWT-based Authentication má»™t cÃ¡ch an toÃ n vÃ  hiá»‡u quáº£?
- CÃ³ best practices nÃ o cho viá»‡c quáº£n lÃ½ cÃ¡c roles vÃ  permissions trong má»™t há»‡ thá»‘ng Microservices?

## ğŸ“‹ Káº¿ hoáº¡ch ngÃ y mai

### Nhiá»‡m vá»¥ Æ°u tiÃªn
- [ ] **High**: Triá»ƒn khai Kafka Consumer trong Page Service Ä‘á»ƒ láº¯ng nghe topic `event-created` tá»« Event Service vÃ  cáº­p nháº­t `featured_events`.
- [ ] **Medium**: Viáº¿t Unit Tests cho cÃ¡c Service classes vÃ  logic phÃ¢n quyá»n.
- [ ] **Low**: Báº¯t Ä‘áº§u nghiÃªn cá»©u vá» Springdoc OpenAPI Ä‘á»ƒ tá»± Ä‘á»™ng táº¡o tÃ i liá»‡u API.

### Má»¥c tiÃªu há»c táº­p
- [ ] Äá»c tÃ i liá»‡u sÃ¢u hÆ¡n vá» Spring for Apache Kafka, Ä‘áº·c biá»‡t lÃ  cÆ¡ cháº¿ Consumer Group vÃ  Commit Offset.
- [ ] TÃ¬m hiá»ƒu vá» TDD (Test-Driven Development) Ä‘á»ƒ cáº£i thiá»‡n quy trÃ¬nh phÃ¡t triá»ƒn.

### CÃ¡c cuá»™c há»p vÃ  thá»i háº¡n
- KhÃ´ng cÃ³ cuá»™c há»p cá»‘ Ä‘á»‹nh.

## ğŸ“Š Tá»± Ä‘Ã¡nh giÃ¡

### NÄƒng suáº¥t
- **Äiá»ƒm**: 9.5/10
- **LÃ½ do**: HoÃ n thÃ nh cÃ¡c má»¥c tiÃªu quan trá»ng, triá»ƒn khai API cho quáº£n lÃ½ thÃ nh viÃªn/ngÆ°á»i theo dÃµi vÃ  thiáº¿t láº­p báº£o máº­t cÆ¡ báº£n.
- **CÃ¡ch cáº£i thiá»‡n**: CÃ³ thá»ƒ tÃ¬m kiáº¿m cÃ¡c vÃ­ dá»¥ vá» cáº¥u hÃ¬nh Spring Security cho Microservices phá»©c táº¡p hÆ¡n.

### Há»c há»i
- **Äiá»ƒm**: 9/10
- **LÃ½ do**: Há»c Ä‘Æ°á»£c nhiá»u vá» Spring Security vÃ  cÃ¡ch triá»ƒn khai Authorization cho cÃ¡c Resource.
- **CÃ¡ch cáº£i thiá»‡n**: Thá»±c hÃ nh debug cÃ¡c váº¥n Ä‘á» báº£o máº­t.

### Há»£p tÃ¡c
- **Äiá»ƒm**: 7.5/10
- **LÃ½ do**: CÃ´ng viá»‡c hÃ´m nay chá»§ yáº¿u lÃ  phÃ¡t triá»ƒn cÃ¡ nhÃ¢n, nhÆ°ng code Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ tÃ­ch há»£p vá»›i cÃ¡c service khÃ¡c.
- **CÃ¡ch cáº£i thiá»‡n**: Chia sáº» cáº¥u hÃ¬nh Spring Security vá»›i nhÃ³m Ä‘á»ƒ thá»‘ng nháº¥t.

### Má»©c Ä‘á»™ hÃ i lÃ²ng tá»•ng thá»ƒ
- **Äiá»ƒm**: 9.5/10
- **LÃ½ do**: Ráº¥t hÃ i lÃ²ng vá»›i tiáº¿n Ä‘á»™ cá»§a Page Service Backend, Ä‘áº·c biá»‡t lÃ  cÃ¡c tÃ­nh nÄƒng báº£o máº­t.
- **CÃ¡ch cáº£i thiá»‡n**: Duy trÃ¬ Ä‘Ã  phÃ¡t triá»ƒn vÃ  sá»± táº­p trung.

## ğŸ“ Tá»‡p Ä‘Ã­nh kÃ¨m & Link liÃªn káº¿t

### TÃ i nguyÃªn há»c táº­p
- [TÃ i liá»‡u Spring Security chÃ­nh thá»©c](https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-requests.html)
- [BÃ i viáº¿t vá» `@PreAuthorize` trong Spring Security](https://www.baeldung.com/spring-security-method-security)

#### - Danh sÃ¡ch cÃ¡c video Ä‘Ã£ xem:
    - Video hÆ°á»›ng dáº«n Spring Security cho REST API.
    - Video vá» cÃ¡ch implement Custom PermissionEvaluator.

### Code & Dá»± Ã¡n
- [Link GitHub Page Service Repo (current state - placeholder)]

### TÃ i liá»‡u há»c táº­p
- [BÃ i viáº¿t vá» Authentication vÃ  Authorization trong Microservices](https://www.okta.com/identity-101/authentication-vs-authorization/)

### áº¢nh chá»¥p mÃ n hÃ¬nh & Báº£n demo
- [Screenshot cáº¥u hÃ¬nh Spring Security]
- [Screenshot Postman test API vá»›i/khÃ´ng cÃ³ quyá»n]

---

**ğŸ“ Ghi chÃº quan trá»ng cho ngÃ y mai:**
Táº­p trung vÃ o viá»‡c tÃ­ch há»£p Kafka Consumer Ä‘á»ƒ Page Service cÃ³ thá»ƒ láº¯ng nghe cÃ¡c sá»± kiá»‡n tá»« Event Service, má»™t bÆ°á»›c quan trá»ng trong kiáº¿n trÃºc Microservices.

**ğŸ¯ Tiáº¿n Ä‘á»™ so vá»›i má»¥c tiÃªu tuáº§n:**
**100%** (HoÃ n thÃ nh API Page, Member, Follower; Setup Spring Security, Authorization)

---
_Worklog created by: LÆ° Hiáº¿u Trung_
_Next review: 30/11/2025_